# CPL WebAssembly Quick Start

## For Users

### Try Online (Easiest)
Visit https://msakai.github.io/cpl/ and start using CPL immediately!

### Commands to Try
```
cpl> simp 1 + 1
cpl> let id(x) = x
cpl> edit
| left T() = {}
| ;
cpl> help
```

## For Developers

### Build WASM Version
```bash
# Install GHC WASM toolchain first (see README)
./scripts/build-wasm.sh
```

### Test Locally
```bash
cd wasm
python3 -m http.server 8000
# Open http://localhost:8000
```

### Build Native Version (for development)
```bash
stack build
stack exec cpl
```

## Files Overview

```
CPL/
├── src/Main.hs              # WASM Console implementation
├── CPL.cabal                # WASM build flag
├── scripts/build-wasm.sh    # WASM build script
├── wasm/
│   ├── index.html           # Web interface
│   ├── cpl-terminal.js      # Terminal controller
│   ├── cpl.wasm             # Generated by build
│   └── README.md            # Detailed docs
└── .github/workflows/
    └── wasm-deploy.yaml     # Auto-deployment
```

## Troubleshooting

### Build fails
```bash
# Check toolchain
wasm32-wasi-ghc --version
wasm32-wasi-cabal --version

# Clean and rebuild
./scripts/build-wasm.sh --clean
```

### Browser doesn't load
- Check browser console (F12)
- Ensure using http:// not file://
- Try different browser

### Native build fails
```bash
# Use Stack instead
stack build
```

## Key Implementation Details

### Haskell FFI (src/Main.hs)
```haskell
#if defined(USE_WASM_BACKEND)
foreign import javascript unsafe "terminal_readLine($1)"
  js_readLine :: JSVal -> IO JSVal
#endif
```

### JavaScript FFI (wasm/cpl-terminal.js)
```javascript
window.terminal_readLine = async (prompt) => {
  return await cplTerminal.readLine(String(prompt));
};
```

### Build Flag (CPL.cabal)
```bash
wasm32-wasi-cabal configure -fWASM -f-Readline -f-Haskeline
```

## Architecture

```
Browser
  ├── xterm.js (terminal UI)
  └── cpl-terminal.js (FFI bridge)
       └── cpl.wasm (CPL interpreter)
            └── Haskell runtime
```

## Next Steps

1. **Test locally** - Build and run locally first
2. **Push to GitHub** - Triggers automatic deployment
3. **Check Actions** - Verify build succeeds
4. **Visit Pages** - Test deployed version
5. **Report issues** - Use GitHub Issues

## Resources

- Main README: ../README.markdown
- Implementation details: ../WASM_IMPLEMENTATION.md
- WASM docs: wasm/README.md
- GHC WASM guide: https://ghc.gitlab.haskell.org/ghc/doc/users_guide/wasm.html
